import numpy as np
import os


def pretty_id(job_id_str):
    template = job_id_str.split("-")[0]
    job = job_id_str.split("-")[1]
    return int("{:02d}{:02d}".format(int(template), int(job)))


DATA_FOLDER = "../../datasets/tpcx-bb"

CONFIG_PATH = "config.json"

OUTPUT_FOLDER = "output--"

WITH_INTENSIVE = False

SEPARATE_INTERSECTIONS_MUL = True

SEPARATE_INTERSECTIONS_X = True

SHARED_WITHIN_TEMPLATES = False

INTENSIVE_WORKLOADS = []

filenames = list(os.listdir(DATA_FOLDER))
jobs_str = list(map(lambda fname: fname.split(".csv")[0], filenames))

# 58 offline + 870 online workloads --> 928 total training workloads
training_workloads_str = [
    "1-5", "1-7", "10-0", "11-2", "12-3", "12-8", "13-4", "13-6", "14-0",
    "14-5", "15-3", "15-4", "16-3", "16-4", "17-4", "17-5", "18-1", "18-8",
    "19-4", "19-7", "2-0", "2-2", "20-4", "20-6", "21-1", "21-7", "22-2",
    "22-7", "23-0", "23-4", "24-3", "24-5", "25-1", "25-7", "26-5", "26-8",
    "27-7", "27-8", "28-0", "28-3", "29-1", "29-3", "3-0", "3-2", "30-0",
    "30-8", "4-6", "4-7", "5-1", "5-6", "6-2", "6-4", "7-2", "7-3", "8-5",
    "8-6", "9-0", "9-3", "1-29", "1-12", "1-37", "1-36", "1-23", "1-27", "1-39",
    "1-38", "1-11", "1-13", "1-2", "1-8", "1-34", "1-18", "1-19", "1-31",
    "1-25", "1-14", "1-6", "1-15", "1-0", "1-10", "2-26", "2-9", "2-7", "2-31",
    "2-24", "2-21", "2-18", "2-29", "2-27", "2-16", "2-37", "2-3", "2-36",
    "2-19", "2-32", "2-13", "2-17", "2-34", "2-25", "2-20", "2-12", "2-6",
    "3-24", "3-3", "3-7", "3-8", "3-12", "3-30", "3-6", "3-31", "3-27", "3-21",
    "3-4", "3-19", "3-32", "3-38", "3-14", "3-15", "3-35", "3-18", "3-13",
    "3-1", "3-25", "3-26", "4-4", "4-8", "4-36", "4-38", "4-11", "4-15", "4-2",
    "4-27", "4-12", "4-30", "4-21", "4-28", "4-23", "4-35", "4-37", "4-31",
    "4-32", "4-24", "4-34", "4-3", "4-13", "4-33", "5-3", "5-39", "5-10",
    "5-31", "5-18", "5-27", "5-37", "5-23", "5-24", "5-5", "5-16", "5-34",
    "5-19", "5-2", "5-26", "5-29", "5-38", "5-12", "5-35", "5-20", "5-4",
    "5-36", "6-21", "6-26", "6-38", "6-14", "6-0", "6-35", "6-31", "6-37",
    "6-8", "6-30", "6-11", "6-20", "6-10", "6-1", "6-28", "6-23", "6-34",
    "6-27", "6-9", "6-16", "6-18", "6-36", "7-10", "7-19", "7-11", "7-25",
    "7-38", "7-23", "7-27", "7-22", "7-26", "7-32", "7-30", "7-16", "7-9",
    "7-4", "7-0", "7-29", "7-12", "7-1", "7-33", "7-31", "7-20", "7-34",
    "8-37", "8-7", "8-20", "8-2", "8-23", "8-18", "8-28", "8-31", "8-38",
    "8-10", "8-33", "8-17", "8-26", "8-13", "8-3", "8-39", "8-30", "8-11",
    "8-1", "8-8", "8-14", "8-22", "9-20", "9-22", "9-38", "9-19", "9-7",
    "9-35", "9-26", "9-23", "9-31", "9-13", "9-4", "9-18", "9-25", "9-37",
    "9-12", "9-11", "9-28", "9-16", "9-10", "9-8", "9-6", "9-39", "10-14",
    "10-9", "10-4", "10-10", "10-6", "10-3", "10-19", "10-7", "10-17", "10-13",
    "10-11", "11-14", "11-11", "11-0", "11-9", "11-13", "11-16", "11-7",
    "11-17", "11-3", "11-1", "11-12", "12-21", "12-10", "12-14", "12-11",
    "12-0", "12-2", "12-4", "12-26", "12-13", "12-18", "12-31", "12-39",
    "12-29", "12-38", "12-27", "12-37", "12-15", "12-6", "12-22", "12-12",
    "12-28", "12-36", "13-12", "13-25", "13-10", "13-0", "13-9", "13-23",
    "13-36", "13-39", "13-17", "13-16", "13-11", "13-15", "13-22", "13-33",
    "13-30", "13-27", "13-7", "13-2", "13-26", "13-1", "13-14", "13-24",
    "14-15", "14-7", "14-24", "14-17", "14-18", "14-37", "14-32", "14-20",
    "14-19", "14-27", "14-12", "14-28", "14-11", "14-23", "14-1", "14-39",
    "14-36", "14-9", "14-3", "14-38", "14-30", "14-4", "15-23", "15-0", "15-35",
    "15-13", "15-9", "15-11", "15-24", "15-14", "15-20", "15-8", "15-27",
    "15-12", "15-25", "15-30", "15-19", "15-5", "15-37", "15-10", "15-22",
    "15-28", "15-36", "15-33", "16-17", "16-31", "16-38", "16-25", "16-1",
    "16-28", "16-23", "16-36", "16-12", "16-21", "16-6", "16-19", "16-9",
    "16-30", "16-33", "16-16", "16-5", "16-14", "16-24", "16-22", "16-10",
    "16-26", "17-31", "17-15", "17-3", "17-22", "17-6", "17-19", "17-23",
    "17-21", "17-7", "17-39", "17-36", "17-10", "17-17", "17-24", "17-12",
    "17-27", "17-0", "17-1", "17-8", "17-28", "17-34", "17-14", "18-16",
    "18-22", "18-12", "18-32", "18-26", "18-10", "18-33", "18-19", "18-20",
    "18-23", "18-29", "18-6", "18-11", "18-34", "18-28", "18-4", "18-36",
    "18-24", "18-15", "18-27", "18-39", "18-30", "19-27", "19-38", "19-28",
    "19-11", "19-34", "19-9", "19-33", "19-10", "19-37", "19-25", "19-23",
    "19-30", "19-13", "19-20", "19-22", "19-15", "19-16", "19-12", "19-14",
    "19-21", "19-5", "19-39", "20-30", "20-0", "20-33", "20-23", "20-27",
    "20-9", "20-26", "20-2", "20-35", "20-10", "20-16", "20-8", "20-19",
    "20-34", "20-13", "20-14", "20-15", "20-24", "20-32", "20-5", "20-12",
    "20-11", "21-26", "21-33", "21-8", "21-6", "21-18", "21-0", "21-35",
    "21-21", "21-38", "21-34", "21-30", "21-22", "21-4", "21-11", "21-29",
    "21-14", "21-25", "21-39", "21-3", "21-2", "21-15", "21-32", "22-30",
    "22-37", "22-6", "22-1", "22-39", "22-10", "22-17", "22-12", "22-26",
    "22-29", "22-4", "22-9", "22-13", "22-14", "22-0", "22-36", "22-35",
    "22-33", "22-5", "22-16", "22-31", "22-8", "23-5", "23-1", "23-33",
    "23-34", "23-24", "23-11", "23-25", "23-27", "23-16", "23-35", "23-23",
    "23-28", "23-21", "23-39", "23-38", "23-19", "23-15", "23-17", "23-14",
    "23-10", "23-2", "23-6", "24-11", "24-30", "24-25", "24-28", "24-7",
    "24-21", "24-29", "24-36", "24-27", "24-26", "24-35", "24-22", "24-6",
    "24-2", "24-38", "24-37", "24-12", "24-18", "24-1", "24-9", "24-16",
    "24-15", "25-38", "25-16", "25-25", "25-17", "25-39", "25-3", "25-23",
    "25-20", "25-26", "25-5", "25-11", "25-33", "25-37", "25-29", "25-19",
    "25-28", "25-8", "25-13", "25-31", "25-18", "25-27", "25-6", "26-17",
    "26-37", "26-33", "26-31", "26-4", "26-1", "26-23", "26-29", "26-18",
    "26-25", "26-32", "26-14", "26-10", "26-35", "26-30", "26-39", "26-19",
    "26-2", "26-36", "26-20", "26-11", "26-6", "27-37", "27-10", "27-6",
    "27-18", "27-21", "27-12", "27-2", "27-33", "27-0", "27-27", "27-20",
    "27-23", "27-38", "27-32", "27-3", "27-22", "27-14", "27-35", "27-29",
    "27-34", "27-16", "27-1", "28-32", "28-36", "28-6", "28-38", "28-4",
    "28-19", "28-18", "28-10", "28-13", "28-2", "28-14", "28-28", "28-34",
    "28-8", "28-30", "28-5", "28-23", "28-22", "28-21", "28-33", "28-7",
    "28-16", "29-33", "29-0", "29-10", "29-28", "29-17", "29-5", "29-26",
    "29-15", "29-13", "29-2", "29-27", "29-37", "29-23", "29-11", "29-36",
    "29-38", "29-19", "29-20", "29-30", "29-8", "29-21", "29-34", "30-20",
    "30-15", "30-6", "30-13", "30-7", "30-4", "30-16", "30-14", "30-31",
    "30-22", "30-12", "30-1", "30-17", "30-26", "30-37", "30-28", "30-11",
    "30-2", "30-38", "30-25", "30-23", "30-32", "1-35", "1-4", "1-1", "1-30",
    "1-32", "1-20", "1-22", "1-28", "2-33", "2-5", "2-10", "2-28", "2-35",
    "2-39", "2-30", "2-8", "3-23", "3-37", "3-28", "3-36", "3-10", "3-16",
    "3-39", "3-33", "4-0", "4-16", "4-19", "4-18", "4-17", "4-39", "4-20",
    "4-5", "5-32", "5-17", "5-25", "5-14", "5-33", "5-28", "5-9", "5-30",
    "6-7", "6-29", "6-3", "6-24", "6-6", "6-15", "6-32", "6-25", "7-6", "7-5",
    "7-18", "7-28", "7-37", "7-36", "7-39", "7-8", "8-19", "8-32", "8-21",
    "8-16", "8-0", "8-34", "8-15", "8-25", "9-34", "9-14", "9-15", "9-9",
    "9-33", "9-17", "9-29", "9-24", "10-5", "10-8", "10-1", "10-16", "11-6",
    "11-8", "11-18", "11-19", "12-16", "12-1", "12-5", "12-33", "12-24",
    "12-25", "12-17", "12-35", "13-38", "13-20", "13-28", "13-18", "13-21",
    "13-35", "13-31", "13-3", "14-34", "14-35", "14-31", "14-21", "14-14",
    "14-10", "14-16", "14-8", "15-29", "15-32", "15-2", "15-34", "15-39",
    "15-18", "15-7", "15-26", "16-8", "16-7", "16-20", "16-2", "16-18", "16-0",
    "16-35", "16-32", "17-29", "17-9", "17-11", "17-13", "17-35", "17-38",
    "17-30", "17-33", "18-0", "18-3", "18-35", "18-21", "18-13", "18-17",
    "18-38", "18-18", "19-8", "19-3", "19-19", "19-2", "19-6", "19-26", "19-36",
    "19-31", "20-29", "20-37", "20-28", "20-22", "20-38", "20-1", "20-36",
    "20-31", "21-27", "21-9", "21-5", "21-31", "21-16", "21-10", "21-20",
    "21-19", "22-32", "22-38", "22-20", "22-3", "22-22", "22-15", "22-27",
    "22-25", "23-9", "23-12", "23-8", "23-7", "23-18", "23-32", "23-37",
    "23-22", "24-8", "24-4", "24-14", "24-17", "24-39", "24-34", "24-13",
    "24-19", "25-4", "25-34", "25-12", "25-21", "25-2", "25-10", "25-32",
    "25-35", "26-27", "26-26", "26-28", "26-7", "26-13", "26-21", "26-16",
    "26-0", "27-13", "27-26", "27-15", "27-11", "27-5", "27-19", "27-36",
    "27-9", "28-17", "28-24", "28-20", "28-29", "28-9", "28-1", "28-37",
    "28-11", "29-12", "29-4", "29-6", "29-32", "29-25", "29-22", "29-16",
    "29-14", "30-3", "30-24", "30-29", "30-27", "30-34", "30-39", "30-30",
    "30-5"]

test_workloads_str = [j for j in jobs_str if j not in training_workloads_str]

str_to_id = {job_str: pretty_id(job_str) for job_str in jobs_str}
id_to_str = {str_to_id[key]: key for key in str_to_id}


PARAM_WORKLOADS = sorted([str_to_id[j]
                          for j in jobs_str])  # all workloads (numeric ids)
TEMPLATES = {}  # all workloads (mapping from template id to jobid (numeric))
# only test workloads (mapping from template id to jobid (numeric))
TEST_WORKLOADS = {}

for j in jobs_str:
    temp = j.split("-")[0]
    id = str_to_id[j]
    if temp in TEMPLATES:
        TEMPLATES[temp].append(id)
    else:
        TEMPLATES[temp] = [id]

    if j not in training_workloads_str:
        if temp in TEST_WORKLOADS:
            TEST_WORKLOADS[temp].append(id)
        else:
            TEST_WORKLOADS[temp] = [id]


# whether or not to destroy the LODS file upon serialization
DESTROY_ON_SERIALIZE = False


def get_config_dict():
    dico = {
        'DATA_FOLDER': DATA_FOLDER,
        'CONFIG_PATH': CONFIG_PATH,
        'OUTPUT_FOLDER': OUTPUT_FOLDER,
        'WITH_INTENSIVE': WITH_INTENSIVE,
        'SEPARATE_INTERSECTIONS_MUL': SEPARATE_INTERSECTIONS_MUL,
        'SEPARATE_INTERSECTIONS_X': SEPARATE_INTERSECTIONS_X,
        'INTENSIVE_WORKLOADS': INTENSIVE_WORKLOADS,
        'PARAM_WORKLOADS': PARAM_WORKLOADS,
        'TEMPLATES': TEMPLATES,
        'TEST_WORKLOADS': TEST_WORKLOADS,
        'DESTROY_ON_SERIALIZE': DESTROY_ON_SERIALIZE,
        'SHARED_WITHIN_TEMPLATES': SHARED_WITHIN_TEMPLATES,
        'str_to_id': str_to_id,
        'id_to_str': id_to_str,
        'training_workloads_str': training_workloads_str
    }
    return dico
